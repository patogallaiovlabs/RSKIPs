<h1 id="cumulative-difficulty-in-json-rpc-block-responses">Cumulative Difficulty in JSON-RPC block responses</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">157</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">Cumulative Difficulty in JSON-RPC block responses</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">11-FEB-20</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">MP</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Usa</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Node</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">1</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Draft</td>
    </tr>
  </tbody>
</table>

<h2 id="abstract">Abstract</h2>

<p>The current RSKIP proposes <code class="highlighter-rouge">cumulativeDifficulty</code> as a new field to be added in the responses of existing JSON-RPC block methods. The value of this field is the sum of a block’s difficulty plus its uncles’ difficulties.</p>

<h2 id="motivation">Motivation</h2>

<p>The existing <code class="highlighter-rouge">difficulty</code> field in responses is defined as a magnitude indicating the effort required <em>for a single miner</em> to mine a single block for it to be added to the blockchain. However, this single value does not represent the total effort required by <em>all miners</em> in the network, since the block not only anchors to its parent, but to its uncles as well. We thus define the magnitude <code class="highlighter-rouge">cumulativeDifficulty</code>, which encompasses not only the block’s difficulty, but its mined uncles’ difficulty as well.</p>

<p>Due to multiple needs, such as forensics or statistics, we may sometimes need to make a reconstruction of the network hashrate evolution; in full, or for a subset period. Many of the former mentioned needs require <code class="highlighter-rouge">cumulativeDifficulty</code> for their calculation because it reflects the effort performed by all the miners (mainchain winning block and uncles).</p>

<p>JSON-RPC block methods do not provide the required information to calculate <code class="highlighter-rouge">cumulativeDifficulty</code> without requiring multiple interactions (querying for a block and all its uncles). Thus, we propose adding a <code class="highlighter-rouge">cumulativeDifficulty</code> field to the existing <code class="highlighter-rouge">eth_getBlockX</code> and <code class="highlighter-rouge">eth_getUncleX</code> responses.</p>

<h2 id="specification">Specification</h2>

<p>The field <code class="highlighter-rouge">cumulativeDifficulty</code> is to be added to the following JSON-RPC block methods:</p>

<ul>
  <li><code class="highlighter-rouge">eth_getBlockByHash</code></li>
  <li><code class="highlighter-rouge">eth_getBlockByNumber</code></li>
  <li><code class="highlighter-rouge">eth_getUncleByBlockHashAndIndex</code></li>
  <li><code class="highlighter-rouge">eth_getUncleByBlockNumberAndIndex</code></li>
</ul>

<p>The following pseudo-code shows how the field is to be computed:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def cumulativeDifficulty(block):
    cumulativeDiff = block.difficulty
    
    for uncle in block.uncles:
        cumulativeDiff += uncle.difficulty

    return cumulativeDiff
</code></pre></div></div>

<h3 id="copyright">Copyright</h3>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
