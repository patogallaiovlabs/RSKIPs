<h1 id="dupn-and-swapn-opcodes">DUPN and SWAPN opcodes</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">26</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">DUPN and SWAPN opcodes</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">27-DIC-16</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">SDL</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Sca</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">1</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Adopted</td>
    </tr>
  </tbody>
</table>

<h2 id="pre-git-revisions">Pre-git revisions</h2>

<p>Revision date: 27/OCT/2017</p>

<p>Revision: 3</p>

<p>Last Modification: Clarification added that opcode arguments are passed on the stack.</p>

<h1 id="abstract"><strong>Abstract</strong></h1>

<p>Currently the RSK/Ethereum opcode set has no way to access elements that are too far in the stack. The opcodes DUP1 to DUP16 allow to retrieve elements up to a depth of 16. The opcodes SWAP1 to SWAP16 allow to swap an element up to depth 16 with the first element. When creating stack frames, and nested stack structures, itâ€™s very common to require access to an element in the stack whose depth must be computed. Therefore the need for DUPN and SWAPN. This RSKIP defines the new opcodes DUPN and SWAPN.</p>

<h2 id="discussion">Discussion</h2>

<p>An alternative to passing the argument N is by creating a compound opcode, where N is specified as a 16-bit word in the code addresses following the DUPN/SWAPN opcodes. However this argument passing format makes static code analysis more difficult. However it does not restrict static code analysis since the code is scanned from top to bottom to identify jump destinations before it is executed.</p>

<h1 id="specification"><strong>Specification</strong></h1>

<p>Both DUPN and SWAPN receive a single argument <strong>on the stack</strong>: the stack depth. The argument is popped from the stack before the command is executed.</p>

<p>DUPN with depth 0 is equivalent to DUP1. DUPN opcode number is 0xa8.</p>

<p>SWAPN with a depth of 0 is equivalent to SWAP1. SWAPN opcode number is 0xa9.</p>

<p>If there are not enough stack elements to execute DUPN /SWAPN, then an Out of Gas exception will be thrown.</p>

<h1 id="copyright"><strong>Copyright</strong></h1>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
