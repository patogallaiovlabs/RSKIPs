<h1 id="removal-of-unused-headers-from-the-bridge-contract">Removal of Unused Headers from the Bridge Contract</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">115</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">Removal of Unused Headers from the Bridge Contract</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">2019</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">SDL</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Sca</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">2</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Draft</td>
    </tr>
  </tbody>
</table>

<h1 id="abstract"><strong>Abstract</strong></h1>

<p>Currently the Bitcoin network generates 52K headers per year.  The RSK Bridge currently accumulates 500k Bitcoin headers. These headers are required to find the best chain and to proving inclusion of transactions. However after a certain period has passed (i.e. a month) proving inclusion and re-oganizing the blockchain seems unprovable.  Therefore, we propose that at certain height with timestamp T, corresponding to a network upgrade, all headers prior  T-(1 month) are partially removed. One every 100 headers is kept. The headers kept are conceptually moved to a different list, the oldList. A new Bridge method to register a BTC transfer transfer for very old headers is added. This new method can lookup a header in the oldList, provided the user shows a list of headers that are children of a header in the oldList. Other future methods that allow proving the inclusion of any transaction (i.e. for BTO) must are also extended to support old headers.</p>

<h1 id="motivation"><strong>Motivation</strong></h1>

<p>Reducing the time it takes to download the state by fast sync is paramount. Currently the Bitcoin headers stored in the bridge account for 90% of all state data (<strong>check this</strong>). Therefore we can trim the state and reduce downloading time by removing unnecessary and unused headers, yet keeping the same functionality in the Bridge.</p>

<h1 id="specification"><strong>Specification</strong></h1>

<p>A new method is added to the Bridge:</p>

<p>registerOldBtcTransaction(bytes btcTxSerialized, int height, byte pmtSerialized, bytes firstHeader, bytes connectHeaders)</p>

<ul>
  <li>firsHeader must represent a 80-byte Bitcoin header.</li>
  <li>connectHeaders must be a height-increasing list of headers without the 32-byte parent value (which can be derived from the previous header). Therefore each record in connectHeaders is 48 bytes in length. The last header in connectHeaders must be the parent of a header with (height % 100==0) that is stored in the oldList vector.</li>
  <li>the transaction btcTxSerialized must be included in firstHeader.</li>
  <li>the height corresponds to the height of the firstHeader.</li>
  <li>If (height % 100 ==0) then both firstHeader and connectHeaders[] should be empty.</li>
  <li>The maximum length of connectHeaders is 98.</li>
  <li>No verification of the validity of the headers is made (difficulty, timestamp, etc.) except to check that each header is a child of the next one and the last is a child of the checkpoint in oldList.</li>
</ul>

<p>Every time receiveHeaders is called, old headers (older than 1 month) should be either removed or moved to oldList. The headers moved to oldList are the ones with (height %100 ==0).</p>

<p><strong>TO DO</strong></p>

<p>It is important that the user is notified somehow if the operations registerBtcTransaction or registerOldBtcTransaction have failed, and in that case, why.</p>

<h1 id="copyright"><strong>Copyright</strong></h1>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
