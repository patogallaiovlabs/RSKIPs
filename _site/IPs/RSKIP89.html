<h1 id="add-bitcoin-block-query-methods-to-the-bridge-contract">Add Bitcoin block query methods to the bridge contract</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">89</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">Add Bitcoin block query methods to the bridge contract</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">JULY-2018</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">SDL</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Usa</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">2</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Adopted</td>
    </tr>
  </tbody>
</table>

<h1 id="abstract"><strong>Abstract</strong></h1>

<p>The bridge does not provide methods for the location and retrieval of information related to a specific block in the bridge storage.
Extracting information from the Bridge view of the Bitcoin blockchain ise useful for numerous applications, such as p2p swaps.
The current RSKIP proposes that the new methods are limited to be called offchain.
However, this same methods may be in opened to smart-contracts in the future, creating a reliable Bitcoin blockchain oracle.</p>

<h1 id="motivation"><strong>Motivation</strong></h1>

<p>Create the foundations for making available a bitcoin blockchain oracle to RSK smart-contracts.</p>

<h1 id="specification"><strong>Specification</strong></h1>

<p>Three new methods are added to the RSK bridge:</p>

<ul>
  <li>int getBtcBlockchainInitialBlockHeight()</li>
</ul>

<p>Returns the first block that is held by the Bridge contract. The bridge contract does not hold all Bitcoin blocks starting from genesis, but a tail. The first block to include was decided when RSK genesis block was created.
The cost of this method call is 20K gas.</p>

<ul>
  <li>string[] getBtcBlockchainBlockLocator()</li>
</ul>

<p>Returns a list of at most 102 block hashes starting from the last, and going backwards with exponentially increasing distances.
The first block hash in the returned array is the last block. The remaining block hashes correspond to the block heights computed as (bestBlockHeight - 2^i), for i starting at 0.
If the height lies below the initial block height, then it is not returned.
The last elements is always the initial block hash.
The cost of this method call is 76K gas.</p>

<ul>
  <li>bytes getBtcBlockchainBlockHashAtDepth(int256 depth)</li>
</ul>

<p>This method returns the serialized block header of a block identified by its depth.
A depth of 0 means the last block of the blockchain.
If the depth surpasses the initial block height, an empty byte array is returned.
The cost of this method call is 20K gas.</p>

<p>None of these new methods can be called onchain.</p>

<h1 id="backwards-compatibility">Backwards Compatibility</h1>

<p>This change is a hard-fork and therefore all full nodes must be updated.</p>

<h1 id="test-cases">Test Cases</h1>

<p>TBD</p>

<h2 id="security-considerations">Security Considerations</h2>

<p>This RSKIP keeps the methods inaccesible to onchain contracts. If they are opened to onchain calls, care must be taken to make sure the gas costs are fair, preventing DoS attacks.</p>

<h1 id="copyright"><strong>Copyright</strong></h1>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
