<h1 id="receive-headers-limits">Receive headers limits</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">200</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">Receive headers limits</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">08-JAN-21</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">PGP &amp; MI</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Sec</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">2</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Adopted</td>
    </tr>
  </tbody>
</table>

<h2 id="abstract">Abstract</h2>

<p>This RSKIP proposes to make the current <code class="highlighter-rouge">receiveHeaders</code> bridge method private while creating a new public method <code class="highlighter-rouge">receiveHeader</code> that allows registering only one header at a time.</p>

<h2 id="motivation">Motivation</h2>

<p>Bridge precompiled contract includes a function <code class="highlighter-rouge">receiveHeaders</code> that receives an array of headers to be stored. This function could be exposed to attacks.
Since powpeg nodes still need to send a group of headers to the Bridge, the current <code class="highlighter-rouge">receiveHeaders</code> function is made private. A new function <code class="highlighter-rouge">receiveHeader</code> is created, which only allows registering one header at a time, to be used by external users.</p>

<h2 id="specification">Specification</h2>

<p>To implement this change we suggest making the following modifications:</p>

<ol>
  <li>Create a new method in the bridge:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> receiveHeader(bytes header) returns (int256 returnValue)
</code></pre></div>    </div>
  </li>
  <li>Make current <code class="highlighter-rouge">receiveHeaders</code> function private</li>
</ol>

<h3 id="receiveheader-validations"><code class="highlighter-rouge">receiveHeader</code> validations</h3>

<p>1) Header has expected size. 
2) Header is not previously saved in storage.
3) Time between calls to receiveHeader is larger than the minimum time between calls allowed. This value can be configured for each network. Initially the value is 300 seconds for all networks.
4) Header previous block must be found in storage.
5) Block depth of the received header is not above the maximum depth allowed. This value can be configured for each network, but initially this is 25 blocks for all networks.</p>

<p>Every time that a block header is accepted, the timestamp is saved in storage to validate that no more calls are made to <code class="highlighter-rouge">receiveHeader</code> until the minimum configured time has elapsed.</p>

<p>When the header is successfully saved, the method returns the value <code class="highlighter-rouge">0</code>.</p>

<h3 id="receiveheader-return-values"><code class="highlighter-rouge">receiveHeader</code> return values</h3>
<ul>
  <li>0  OK</li>
  <li>-1  RECEIVE_HEADER_CALLED_TOO_SOON</li>
  <li>-2  RECEIVE_HEADER_BLOCK_TOO_OLD</li>
  <li>-3  RECEIVE_HEADER_CANT_FOUND_PREVIOUS_BLOCK</li>
  <li>-4  RECEIVE_HEADER_BLOCK_PREVIOUSLY_SAVED</li>
  <li>-20 RECEIVE_HEADER_ERROR_SIZE_MISTMATCH</li>
  <li>-99 RECEIVE_HEADER_UNEXPECTED_EXCEPTION</li>
</ul>

<h3 id="receiveheaders-changes"><code class="highlighter-rouge">receiveHeaders</code> changes</h3>

<p>After the activation of this RSKIP, <code class="highlighter-rouge">receiveHeaders</code> can be called only by members of the Federation.</p>

<h2 id="copyright">Copyright</h2>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
