<h1 id="basic-bridge-for-two-way-peg-to-bitcoin">Basic Bridge for two-way-peg to Bitcoin</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">40</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">Basic Bridge for two-way-peg to Bitcoin</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">25-APR-2017</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">SDL</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Usa</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">2</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Adopted</td>
    </tr>
  </tbody>
</table>

<h1 id="abstract"><strong>Abstract</strong></h1>

<p>This RSKIP specifies the methods the two-ya-peg Bridge exposes and the semantics of each method.</p>

<h1 id="specification"><strong>Specification</strong></h1>

<h2 id="updatecollections">updateCollections</h2>

<p>Parameters: none</p>

<p>Iterates over the getRskTxsWaitingForConfirmations map of Sha3 hashes to transaction values and updates the RskTxsWaitingForSignatures map of Sha3 keys to Bitcoin transaction values including Bitcoin transactions for which there are enough confirmations in the RSK blockchain.</p>

<h2 id="receiveheaders">receiveHeaders</h2>

<p>Parameters: array of bitcoin blocks serialized in Bitcoin wire protocol format</p>

<p>Receives an array of serialized Bitcoin block headers and adds them to the internal BlockChain structure.</p>

<h2 id="registerbtctransaction">registerBtcTransaction</h2>

<p>Parameters: Serialized Bitcoin transaction, block number where the transaction is present, serialized partial merkle tree</p>

<p>Receives a serialized Bitcoin transaction, its height and a serialized partial merkle tree. Verifies the transaction hash is part of the merkle tree.</p>

<h2 id="releasebtc">releaseBtc</h2>

<p>Parameters: none, the invoking RSK transaction is the input itself</p>

<p>Calculates a destination Bitcoin address from the address of the RSK transaction sender. Converts the amount in Weis of the RSK transaction to Satoshis for the Bitcoin transaction. If the amount is greater than the minimum non-dust value, the Bitcoin transaction with a single output is added to the map of RSK transaction waiting for confirmations using the Sha3 hash of the RSK transaction hash as key and the Bitcoin transaction as value.</p>

<h2 id="addsignature">addSignature</h2>

<p>Parameters: public key of federation member, array of signatures, RSK transaction hash</p>

<p>The RSK transaction hash is used as key to retrieve the Bitcoin transaction from the internal map.</p>

<p>Each federator must sign all the inputs belonging to the transaction that must release the BTC.</p>

<p>When more than N of M signatures have been collected for the unsigned transaction id, the contract will emit a BtcRelease event.</p>

<h2 id="getstateforbtcreleaseclient">getStateForBtcReleaseClient</h2>

<p>Returns transactions waiting to be signed and transactions waiting to be broadcasted.</p>

<h2 id="getstatefordebugging">getStateForDebugging</h2>

<p>Returns:</p>

<p>RSK Transactions waiting to be broadcasted</p>

<p>RSK Transactions waiting for confirmations</p>

<p>RSK Transactions waiting for signatures.</p>

<p>The Bitcoin blockchain best chain height</p>

<h2 id="getbtcblockchainbestchainheight">getBtcBlockchainBestChainHeight</h2>

<p>Returns the Bitcoin blockchain best chain height known by the Bridge contract.</p>

<h2 id="getbtcblockchainblocklocator">getBtcBlockchainBlockLocator</h2>

<p>Returns hashes of Bitcoin blockchain blocks. Federators can use these hashes to find what is the latest block in the chain the Bridge has and synchronize.</p>

<h2 id="getbtctxhashesalreadyprocessed">getBtcTxHashesAlreadyProcessed</h2>

<p>Returns the list of Bitcoin transaction hashes the Bridge already knows about.</p>

<h2 id="getfederationaddress">getFederationAddress</h2>

<p>Returns the current address of the federation.</p>

<h2 id="getminimumlocktxvalue">getMinimumLockTxValue</h2>

<p>Returns a constant value, the minimum amount of BTC allowed to be locked, in satoshis.</p>

<h1 id="copyright"><strong>Copyright</strong></h1>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
