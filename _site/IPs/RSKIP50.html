<h1 id="script-versions-using-header-pseudo-opcode">Script Versions using HEADER pseudo-opcode</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">50</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">Script Versions using HEADER pseudo-opcode</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">07-DIC-2017</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">SDL</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Sca</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">1</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Adopted</td>
    </tr>
  </tbody>
</table>

<h1 id="abstract"><strong>Abstract</strong></h1>

<p>This RSKIP defines a new pseudo-opcode that is used to mark the existence of a header in the script. This header defines the script VM version, the script language version and can define upto 256 additional header bytes for future use.</p>

<h1 id="motivation"><strong>Motivation</strong></h1>

<p>RSK is definiting new functionality that is currently incompatible with the EVM. However RSK also wants to allow users to easily port their existing Ethereum solutions that do not make use of more advanced features. To acomplish this, we allow the VM code to define an optional header that specifies which virtual machine the code is targeted to.</p>

<h1 id="specification"><strong>Specification</strong></h1>

<p>The new pseudo-opcode HEADER has value 0xfc. To specify a valid header, this opcode must stored at code address zero. If HEADER is stored at offset 0x00, then the following header values are interpreted:</p>

<p>The byte at code address 0x01 is the Executable version. Currently only version 0 is defined. This value currently does not affect how the contract is executed but contracts specifying a value different from 0 may be executed differently in the future. Therefore contract developers should always set this value to zero.
The byte at code offset 0x02 is the VM version. Currently only versions 0 and 1 are defined. Any other value will be currently interpreseted as 1. Developers are discouraged to set any value other than 0 or 1 because this may affect how the contract is executed in the future.</p>

<p>The byte at offset 0x03 is the extended header length (extHeaderLen). The extended header is left for future extensions.</p>

<p>If the header is present then the initial PC from where the contract is executed will be computed as:</p>

<p>PC  = 4 + extHeaderLen</p>

<p>If the header is not present the PC willbe zero, as before.</p>

<p>If the HEADER opcode is present in the code at any offset diffrent of 0x00, it is intepreted as an invalid opcode.</p>

<h1 id="copyright"><strong>Copyright</strong></h1>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
