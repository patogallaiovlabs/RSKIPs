<h1 id="checkenvironment-precompile-method">checkEnvironment Precompile method</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">208</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">checkEnvironment Precompile method</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">JAN-2021</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">SDL</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Usa</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">1</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Draft</td>
    </tr>
  </tbody>
</table>

<h1 id="abstract"><strong>Abstract</strong></h1>

<p>This RSKIP proposes to add a method <code class="highlighter-rouge">checkEnvironment()</code> to a new <code class="highlighter-rouge">Environment</code>  pre-compile contract. The new method receives as argument a list of fields that represents the minimum environment requirements to execute a method and it checks that the requirements are satisfied. This RSKIP provides the same functionality of <a href="https://github.com/rsksmart/RSKIPs/blob/master/IPs/RSKIP203.md">RKIP203</a>, but in a way which allows the future addition of additional environment variables, such as rent gas limit, for storage rent accounting.</p>

<h2 id="motivation">Motivation</h2>

<p>The motivation is the one described in <a href="https://github.com/rsksmart/RSKIPs/blob/master/IPs/RSKIP203.md">RSKIP203</a> plus we add the requirement that contracts that forward contracts calls do not become suddenly vulnerable if a network upgrade adds another hidden counter to the environment.</p>

<p>This RSKIP proposes to create a new <code class="highlighter-rouge">Environment</code> pre-compile contract with a method to check if the minimal environment requirements given as the <code class="highlighter-rouge">env</code> argument are satisfied. The argument contains a list of fields in RLP format. This RSKIP defines that the first argument of the list is the stack depth. The gas limit is left outside <code class="highlighter-rouge">env</code> because the caller must provide the value externally to <code class="highlighter-rouge">CALL</code>. The remaining fields are undefined and are ignored. It is expected that future network upgrades assume default values for missing fields. Users and relayers will negotiate a content for <code class="highlighter-rouge">env</code>. Smart contract do not need to interpret the content of <code class="highlighter-rouge">env</code>, and can simply pass it to the <code class="highlighter-rouge">checkEnvironment()</code> method.</p>

<h2 id="specification">Specification</h2>

<p>The method with signature ` checkEnvironment(bytes env) returns (uint32)<code class="highlighter-rouge"> is added to a new pre-compiled contract named </code>Environment<code class="highlighter-rouge">, created at address </code>0x0000000000000000000000000000000001000011<code class="highlighter-rouge">. The call returns 0 on success. On failure it returns the position of the item in </code>env` that is not satisfied by the environment (1==first item).</p>

<p>The argument <code class="highlighter-rouge">env</code> corresponds to a list of items, each coded in RLP. It is not an RLP list.</p>

<p>The first item is the minimum stack depth. If the argument length is zero, the default value assumed for the stack depth item is 200.</p>

<p>Additional arguments are ignored, even if they decode to invalid RLP data.</p>

<p>The gas cost specific to this method call is 40.</p>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>This is a hard-forking change, but it shouldnâ€™t affect existing smart contracts, because no contract should call a precompile contract with an nonexistent method selector.</p>

<h2 id="test-cases">Test Cases</h2>

<p>TBD</p>

<h2 id="implementation">Implementation</h2>

<p>TBA</p>

<h2 id="security-considerations">Security Considerations</h2>

<p>None identified.</p>

<h1 id="copyright"><strong>Copyright</strong></h1>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.,</p>

