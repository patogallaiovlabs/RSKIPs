<h1 id="extended-bitcoin-bridge-transactions">Extended Bitcoin Bridge Transactions</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">41</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">Extended Bitcoin Bridge Transactions</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">25-APR-2017</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">SDL</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Usa</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">2</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Draft</td>
    </tr>
  </tbody>
</table>

<h1 id="abstract"><strong>Abstract</strong></h1>

<p>This RSKIP proposes different ways funds can be sent to RSK from Bitcoin, and how a Bitcoin transaction can remotely execute a method in an RSK contract.</p>

<h2 id="discussion">Discussion</h2>

<p>The FTWP (see <a href="https://github.com/rsksmart/RSKIPs/blob/master/IPs/RSKIP40.md">RSKIP40</a>) functionality can be extended by the use of an EET (Extended Exit Transaction) to create a new contract, and execute code. The code will receive payments in SBTC and will be able to perform whatever action is needed, and then send back funds to a Bitcoin address by commanding the Bridge.</p>

<h2 id="eet-transactions">EET Transactions</h2>

<p>The easiest way to redeem SBTC in the Rootstock blockchain is by creating an EET transaction. An EET transaction has the following properties:</p>

<ul>
  <li>
    <p>It has only two outputs</p>
  </li>
  <li>
    <p>The first output represents the amount of BTC to transfer to the Rootstock blockchain [the Amount field]. The output address must be the Federators Exit Address.</p>
  </li>
  <li>
    <p>The second output only specifies data. The amount must be zero, and the scriptPub must contain an OP_RETURN opcode and OP_PUSHDATA1 opcode, specifying the size of the data following, followed by payload bytes. The payload contains the following fields, RLP encoded:</p>

    <ul>
      <li>
        <p>EET version (currently 0)</p>
      </li>
      <li>
        <p>The destination address in Rootstock (20 bytes) [DestinationAddress field]</p>
      </li>
      <li>
        <p>The redeem fee for automatic redeem (RegisterBtcLock message). This can be zero to indicate no automatic redeem is necessary [ RskRedeemFee field]</p>
      </li>
      <li>
        <p>Optional if the destination address is a contract:</p>

        <ul>
          <li>
            <p>(0, The maximum gasPrice to pay (1 to 8 bytes)) [gasPrice field]</p>
          </li>
          <li>
            <p>(1, The maximum amount of gas to consume (1 to 8 bytes)) [gasAmount field]</p>
          </li>
          <li>
            <p>(2, A Rootstock refund address, to transfer unused fees, if any (20 bytes) [ RskRefundAddress field]</p>
          </li>
          <li>
            <p>(3, hold time in blocks) [HoldBlocks field]</p>
          </li>
          <li>
            <p>(4, A Bitcoin refund address, to transfer the remaining if no execution occurred, if any (20 bytes)) [ BtcRefundAddress field]</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>The payload size must not exceed 80 bytes (including RLP bytes). If at the time the EET transaction is redeemed in the Rootstock blockchain the network gasPrice is over the specified gasPrice, the transaction will be held for HoldBlock blocks, waiting for manual triggering. No gasPrice re-check will be performed. If HoldBlocks is zero, the transaction will not be held.</p>

<p>If no manual triggering occurs and if a RskRefundAddress is defined, all the funds will be transferred to the RskRefundAddress in Rootstock.</p>

<p>If no manual triggering occurs and no RskRefundAddress is defined, and a BtcRefundAddress is defined, then all the funds will be transferred back from RSK to Bitcoin. Note that any fees required to release BTC funds will be deducted from the Amount field. If the remaining is zero, no refund will take place.</p>

<p>If the transaction is executed automatically then the unused fees (gasAmount*gasPrice) will be transferred to the  RskRefundAddress (after deducting the standard transfer fee).</p>

<p>If the transaction is manually triggered, the all pre-specified fees (gasAmount*gasPrice) will be transferred to the RskRefundAddress ((after deducting the standard transfer fee).</p>

<h2 id="pxt-transactions">PXT Transactions</h2>

<p>A Proxy Transaction (PXT) is a Bitcoin transaction that moves bitcoins to a Bitcoin address which represents a Rootstock address. Without the need for the Federation, a user can create a proxy Bitcoin address that maps to a Rootstock address. This is done by creating a script with the following format: OP_PUSH <RskAddress> (or payload of EET) OP_DROP <Federation script=""> and then hashing it (UserScriptHash). The funds must be sent to a P2SH address of this UserScriptHash.</Federation></RskAddress></p>

<h2 id="sak-same-account-key-transaction">SAK (Same Account Key) Transaction</h2>

<p>Send the funds to the Federation address. The funds are transferred in RSK to the account related to the same public key specified in the scriptSig of the first input of the transaction.</p>

<h2 id="opk-owned-private-key-transactions">OPK (Owned-Private-Key) Transactions</h2>

<p>Similar to SAK but the user has to redeem the money in Rootstock using the private key of the first input of the transaction. This is done by signing a redeem message “RskRedeem address”, with the private key related to the first input and sending this message to the Bridge using the method ReleaseRTS(address, signature). This will be useful over a SAK only when we implement other Public Key architectures (we support now only ECDSA secp256k1)</p>

<p>The first input must be a P2PKH or P2SH and the script must be a standard P2PKH script.</p>

<h1 id="copyright"><strong>Copyright</strong></h1>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
