<h1 id="verification-less-mining">Verification-less mining</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">08</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">Verification-less mining</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">29-SEP-2016</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">SDL</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Fair</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">2</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Draft</td>
    </tr>
  </tbody>
</table>

<h1 id="abstract"><strong>Abstract</strong></h1>

<p>This RSKIP defines how miners can mine a child block without verifying the parent block, and proposes a version of verification-less mining that allows miners to include transactions in a block optimistically.<br />
This RSKIP works best with <a href="https://github.com/rsksmart/RSKIPs/blob/master/IPs/RSKIP10.md">RSKIP10</a>  (Transactions never invalidate blocks).</p>

<h1 id="motivation"><strong>Motivation</strong></h1>

<p>Verification-less mining allows miners to start creating a child block as fast as they receive a parent block header. If such block turns out to be invalid, then they can revert after they discover this or after S seconds, whatever comes first. Verification-less mining is important in RSK because block interval is short, and therefore miners with low hashing power creating large blocks or blocks that consume much CPU to verify have higher probability of creating stale blocks and receiving lower rewards. In the worse case of a well-working blockchain, an uncle is rewarded 50% of that of a normal block. This RSKIP proposes a version of verification-less mining that allows miners to include transactions in a block optimistically, even if prior transactions have not been verified.</p>

<h2 id="discussion">Discussion</h2>

<p>To reduce the time to build a block, miners can optimistically choose transactions they think will pay the highest fee based on the advertised gasprice and the gascount. Since the gascount only establishes a maximum (transactions don’t need to consume all of it), then miners may end up building blocks filing much less gas capacity than the available. However miners can always include simple transactions (without code execution), because the full cost of those is fully known and paid, and minimum simple account balances can be computed without execution EVM code.</p>

<p>To allow the inclusion of transactions without transaction execution, fields that relate the output of the block verification are moved to two blocks down the blockchain (receipts root and state root).</p>

<p>Normally miners cannot start working on a block without computing the previous block state. With verification-less mining, when a miner receives a supposedly best block at height N it will usually have computed the state and receipts for the block at height (N-1). Therefore, it can  start creating a block at height (N+1) on top on block N, adding the state/receipts of block N-1.</p>

<p>This means that SPV wallets cannot always verify the correctness of transactions (receipts) state after a single confirmation: at least two confirmations may be required to detect a new state.</p>

<p>Miners can include simple payments because, even if they do not know the world state after execution of the prior block, they can infer the minimum balance of simple accounts. For example, if a miner sees a transaction T in block N, that consumes 10 bitcoins from an account A that had 15, then he knows that in block (N+1) he can include transactions that withdraw at most 5 bitcoins from A.</p>

<h2 id="other-competing-proposals">Other Competing Proposals</h2>

<p><a href="https://github.com/rsksmart/RSKIPs/blob/master/IPs/RSKIP56.md">RSKIP56</a> presents a version of verification-less mining that does not allow optimistic transaction inclusion.</p>

<p><a href="https://github.com/rsksmart/RSKIPs/blob/master/IPs/RSKIP58.md">RSKIP58</a> presents a header-first block propagation method that does not require verification-less mining and allows arbitrary transaction inclusion.</p>

<h1 id="specification"><strong>Specification</strong></h1>

<p>The block header is changed according to these rules:</p>

<p>The receiptHash is moved from the block at height N, to the block at height N+2 and renamed prevBlockReceiptHash
The worldstateRootHash is moved from the block at height N, to the block at height N+2 renamed prevBlockWorldstateRootHash.</p>

<p>Nodes will verify that the sum of all gaslimits in a transaction does not overpass the block gas limit. This is to prevent miners from gambling, adding transactions that run code that they are unsure if they can be executed within the block gas limit.</p>

<p><strong>Problems</strong></p>

<p>One of the problem of this proposal is that miners may end up only creating verification-less blocks. For their blocks to collect the highest fees they wouldn’t pick transactions that execute code, becaause they can’t predict the amount of fees paid. Therefore they will pick either simple transactions or transactions that have low gaslimits. More complex transactions will only be chosen if mining does not produce blocks for a certain delay (e.g. 5 seconds) and the parent block has been fully verified. In this case it is expected that the node would create a new block candidate and mining pools could push new work units to workers.  If processing/broadcasting blocks takes a time comparable to average block interval, then miners will end up only creating verification-less blocks. A potential solution would be to decouple transaction publication from transaction execution, so miners can publish transactions, but not execute them.</p>

<h1 id="copyright"><strong>Copyright</strong></h1>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
