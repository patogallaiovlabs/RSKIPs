<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Peg-in to any address | RSK Improvement Proposals</title>
    <meta
      property="og:title"
      content="Peg-in to any address | RSK Improvement Proposals"
    />
    <meta name="description" content="RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards." />

  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="https://ips.rsk.co/IPs/RSKIP170" />
  <meta property="og:url" content="https://ips.rsk.co/IPs/RSKIP170" />
  <meta property="og:site_name" content="RSK Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "https://ips.rsk.co",
      "name": "RSK Improvement Proposals",
      "description": "RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" />
      <!-- Google Fonts -->
      <link href="https://fonts.googleapis.com/css?family=Quicksand:400,700,900&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,600,700,800&display=swap" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="RSK Improvement Proposals" /><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0=" crossorigin="anonymous"></script>
</head>
<body><header class="site-header" role="banner">
  <button id="dark-mode-toggle" class="dark-mode-toggle theme-toggle-button">
    <svg class="icon" style="width:24px;height:24px" viewBox="0 0 24 24">
      <path fill="currentColor" d="M7.5,2C5.71,3.15 4.5,5.18 4.5,7.5C4.5,9.82 5.71,11.85 7.53,13C4.46,13 2,10.54 2,7.5A5.5,5.5 0 0,1 7.5,2M19.07,3.5L20.5,4.93L4.93,20.5L3.5,19.07L19.07,3.5M12.89,5.93L11.41,5L9.97,6L10.39,4.3L9,3.24L10.75,3.12L11.33,1.47L12,3.1L13.73,3.13L12.38,4.26L12.89,5.93M9.59,9.54L8.43,8.81L7.31,9.59L7.65,8.27L6.56,7.44L7.92,7.35L8.37,6.06L8.88,7.33L10.24,7.36L9.19,8.23L9.59,9.54M19,13.5A5.5,5.5 0 0,1 13.5,19C12.28,19 11.15,18.6 10.24,17.93L17.93,10.24C18.6,11.15 19,12.28 19,13.5M14.6,20.08L17.37,18.93L17.13,22.28L14.6,20.08M18.93,17.38L20.08,14.61L22.28,17.15L18.93,17.38M20.08,12.42L18.94,9.64L22.28,9.88L20.08,12.42M9.63,18.93L12.4,20.08L9.87,22.27L9.63,18.93Z" />
    </svg>
  </button>


<div class="wrapper"><a class="site-title" rel="author" href="http://localhost:4000/">RSK Improvement Proposals</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link underline" href="http://localhost:4000/all">All</a><a class="page-link underline" href="http://localhost:4000/scalability">Scalability</a><a class="page-link underline" href="http://localhost:4000/security">Security</a><a class="page-link underline" href="http://localhost:4000/usability">Usability</a><a class="page-link underline" href="http://localhost:4000/fairness">Fairness</a><a class="page-link underline" href="http://localhost:4000/standardtrack">Standard Track</a></div>





      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Peg-in to any address</h1>
  </header>

  <div class="post-content">
    <h1 id="peg-in-to-any-address">Peg-in to any address</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">170</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">Peg-in to any address</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">01-SEP-20</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">MI</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">USa</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">2</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Draft</td>
    </tr>
  </tbody>
</table>

<h2 id="abstract">Abstract</h2>

<p>This RSKIP proposes a way for users to transfer BTC to RSK, indicating the RSK address in which they want their RBTCs transferred to and a BTC refund address in case the peg-in can not be completed for some reason.</p>

<h2 id="motivation">Motivation</h2>

<p>Allowing users to peg-in BTC to any address in RSK, EOA or contract.</p>

<h2 id="specification">Specification</h2>

<p>This RSKIP proposes an extension to the current peg-in workflow. By including an output with an OP_RETURN op code and certain payload in the transaction sent to the federation to perform the peg-in, the user can determine the RSK address where the RBTCs will be transferred to and a BTC refund address.</p>

<p>The BTC transaction sent to the federation must contain 
 one output with value 0 and OP_RETURN op code followed by the following data:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">52534b54</code> as prefix indicating the output is for RSK. This values stands for <code class="language-plaintext highlighter-rouge">RSKT</code> (for RSK  transfer) in ascii and hex encoded. (4 bytes)</li>
  <li>Protocol version in hexa (1 byte). Currently <strong>01</strong></li>
  <li>A valid RSK address (20 bytes)</li>
  <li>[Optional] A valid BTC refund address in the following format:
    <ul>
      <li>Address type (1 byte)
        <ul>
          <li>01 for P2PKH</li>
          <li>02 for P2SH</li>
        </ul>
      </li>
      <li>Hash needed to build refund address (20 bytes)
        <ul>
          <li>For P2PKH type address: public key hash</li>
          <li>For P2SH type address: script hash</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="example-output">Example output</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
      "value": 0.00000000,
      "n": 1,
      "scriptPubKey": {
        "asm": "OP_RETURN 52534b5400010e537aad84447a2c2a7590d5f2665ef5cf9b667a014f4c767a2d308eebb3f0f1247f9163c896e0b7d2",
        "hex": "6a2b52534b54010e537aad84447a2c2a7590d5f2665ef5cf9b667a014f4c767a2d308eebb3f0f1247f9163c896e0b7d2",
        "type": "nulldata"
      }
    }
</code></pre></div></div>
<p>Payload included: <code class="language-plaintext highlighter-rouge">52534b54010e537aad84447a2c2a7590d5f2665ef5cf9b667a014f4c767a2d308eebb3f0f1247f9163c896e0b7d2</code></p>

<ul>
  <li>First 4 bytes correspond to the prefix that indicates the output has peg-in instructions for RSK (<code class="language-plaintext highlighter-rouge">RSKT</code> in hexa): <code class="language-plaintext highlighter-rouge">52534b54</code></li>
  <li>Next 1 byte that correspond to the version number in hexa: <code class="language-plaintext highlighter-rouge">01</code></li>
  <li>Next 20 bytes indicate rsk destination address: <code class="language-plaintext highlighter-rouge">0e537aad84447a2c2a7590d5f2665ef5cf9b667a</code></li>
  <li>Next 1 byte indicating btc refund address type, in this case P2PKH: <code class="language-plaintext highlighter-rouge">01</code></li>
  <li>Finally 20 bytes indicating the public key hash that will be used to get the btc refund address: <code class="language-plaintext highlighter-rouge">4f4c767a2d308eebb3f0f1247f9163c896e0b7d2</code></li>
</ul>

<h3 id="new-peg-in-flow">New peg-in flow</h3>

<p>When a BTC transaction is sent to the Bridge, the following steps take place:</p>

<ol>
  <li>Blockchain validations as performed in the existing flow (e.g. amount of confirmations, PMT valid)</li>
  <li>Parse transaction to get RSK destination address and BTC refund address
    <ol>
      <li>If no OP_RETURN data is present, follow the current flow. Get tx sender to use as BTC refund address and derive RSK destination address from BTC public key.</li>
      <li>If OP_RETURN data is present, get RSK destination address from the payload and the BTC refund address if present. In case there is no BTC refund address included in the payload, get the tx sender.</li>
    </ol>
  </li>
</ol>

<h3 id="notes">Notes</h3>
<ul>
  <li>No restriction is added to the maximum length in bytes of the transaction.</li>
  <li>No restriction is added to the total amount of outputs the transaction can have.</li>
  <li>There is no limit to the amount of outputs with OP_RETURN the peg-in transaction can have. But there can be only one with <code class="language-plaintext highlighter-rouge">RSKT</code> prefix indicating peg-in instructions. Transactions with more than one OP_RETURN outputs containing <code class="language-plaintext highlighter-rouge">RSKT</code> prefix will be rejected, following the existing protocol for refunds.</li>
  <li>The output with OP_RETURN containing the peg-in instructions does not have to be in any particular order among the other outputs.</li>
</ul>

<h2 id="rationale">Rationale</h2>

<p><a href="https://github.com/rsksmart/RSKIPs/blob/master/IPs/RSKIP41.md">RSKIP41</a> includes optional fields with the purpose of executing a smart contract in RSK, in case the RSK destination address is a contract instead of an account. In this version of the protocol, the possibility of executing a smart contract from the peg-in transaction is not contemplated.</p>

<p>If the RSK destination address set in the payload is a contract then the locked funds will be transferred to fund this contract. It is <strong>not</strong> required that the contract has a payable fallback function to receive the funds. In case the recipient contract has a payable fallback function with some implementation, the code will not be executed. Only the transfer will be made.</p>

<h2 id="references">References</h2>

<p>[1] https://github.com/rsksmart/RSKIPs/blob/master/IPs/RSKIP41.md</p>

<p>[2] https://bitcoinfoundation.org/files/bitcoin/core-development-update-5/</p>

<h3 id="copyright">Copyright</h3>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer>
    <div class="footer_cont">
        <div class="footer_box">
            <ul class="social-media-list"><li><a href="https://github.com/rsksmart/RSKIPs" target="_blank" rel="noopener"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">Visit on Github</span></a></li></ul>
        </div>
    </div>
</footer><script src="../assets/js/dark_mode.js"></script>
    <script src="../../assets/js/dark_mode.js"></script>
  </body>

</html>
