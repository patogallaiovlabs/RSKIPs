<h1 id="hw-compatible-transaction-versioning-system">HW-compatible Transaction Versioning System</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">212</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">HW-compatible Transaction Versioning System</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">JAN-2021</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">SDL</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Sca</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">1</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Draft</td>
    </tr>
  </tbody>
</table>

<h1 id="abstract"><strong>Abstract</strong></h1>

<p>This RSKIP proposes the addition of a version field to transactions maintaining high compatibility with existent hardware wallets, and requiring minimum changes from software wallets.</p>

<h2 id="motivation">Motivation</h2>

<p>Many features, like ephemeral calldata, multi-signed transactions and LTCP transaction compression require adding more information to transactions. However currently RSK transactions do not have a way to indicate a new transaction format is being used. We propose a transaction format that embeds a version field in the current nonce field, keeping maximum compatibility with wallets, specially hardware wallets.</p>

<h2 id="specification">Specification</h2>

<p>Currently the transaction contains the following fields, stored using RLP:</p>

<ol>
  <li>nonce</li>
  <li>gasPrice</li>
  <li>gasLimit</li>
  <li>ReceiveAddress</li>
  <li>value</li>
  <li>data</li>
  <li>v</li>
  <li>r</li>
  <li>s</li>
</ol>

<p>When serialized, each field begins with an RLP identifier that indicates if the item is an element or a list of elements. This format will be called version 0.</p>

<p>For version 1, the constant (1«32) is added to the nonce, and the field is renamed nonceAndVersion, to avoid confusion. As most transactions have nonces below 256, the change implies adding 3 zero bytes of padding to the serialized format, which results in approximately a 3% overhead.</p>

<p>The encoded nonceAndVersion must be masked with (1«32)-1 for the extraction of the nonce value.</p>

<p>The only version value accepted is 1. Following RSKIPs can define additional versions.</p>

<h1 id="rationale">Rationale</h1>

<p>This change was selected because it doesn’t break compatibility of most hardware wallets. Another (cleaner) method would be adding a version field to the transaction RLP list, which doesn’t bring any overhead, but requires parsing the whole RLP encoded transaction before the version can be detected.</p>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>This change is a hard-fork and therefore all full nodes must be updated.</p>

<h2 id="test-cases">Test Cases</h2>

<p>TBD</p>

<h2 id="implementation">Implementation</h2>

<p>TBD</p>

<h1 id="copyright"><strong>Copyright</strong></h1>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>

