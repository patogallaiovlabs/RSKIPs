<h1 id="obtain-bitcoin-block-information-from-bridge-methods">Obtain Bitcoin Block information from bridge methods</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">220</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">Obtain Bitcoin Block information from bridge methods</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">26-MAR-21</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">PGP,SDL</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Usa</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">2</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Adopted</td>
    </tr>
  </tbody>
</table>

<h2 id="abstract">Abstract</h2>

<p>The Bridge contract stores information about the Bitcoin blockchain. This RSKIP proposes the addition of new methods to the Bridge contract, that enable RSK smart contracts to query information about the Bitcoin best chain and retrieve its block headers. This introduces in RSK a decentralized cryptoeconomic (SPV) Bitcoin blockchain oracle for financial contracts, swaps, and other applications.</p>

<p>Also this proposal enables certain use cases where RSK contracts need cryptoeconomic random values. The header of a Bitcoin block contains cryptoeconomic randomness in its proof-of-work hash. A contract can wait until a certain Bitcoin block (specified by height) is added to the Bridge, and then use the header hash as a seed to extract pseudo-random values.</p>

<p>This change implies a consensus change and should be included in a network upgrade.</p>

<h2 id="specification">Specification</h2>

<p>The following new methods are added to the Bridge Contract:</p>

<h3 id="getbtcblockchainbestblockheader">getBtcBlockchainBestBlockHeader</h3>

<h4 id="abi-signature">ABI signature</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function getBtcBlockchainBestBlockHeader() returns (bytes)
</code></pre></div></div>

<h4 id="specification-1">Specification</h4>

<p>This method simply returns the serialized bitcoin block header that is at the moment the tip of the mainchain.
The gas cost is 3800.</p>

<h3 id="getbtcblockchainblockheaderbyhash">getBtcBlockchainBlockHeaderByHash</h3>

<h4 id="abi-signature-1">ABI signature</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function getBtcBlockchainBlockHeaderByHash(bytes32) returns (bytes)
</code></pre></div></div>

<h4 id="specification-2">Specification</h4>

<p>This method expects to receive a Sha256 value representing a Bitcoin block header hash. If the hash matches a registered bitcoin block it will serialize the header and send it to the user, otherwise, it will return an empty byte array.
The gas cost is 4600.</p>

<h3 id="getbtcblockchainblockheaderbyheight">getBtcBlockchainBlockHeaderByHeight</h3>

<h4 id="abi-signature-2">ABI signature</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function getBtcBlockchainBlockHeaderByHeight(uint256) returns (bytes)
</code></pre></div></div>

<h4 id="specification-3">Specification</h4>

<p>This method expects to receive an integer value representing a bitcoin block height. The Bridge will lookup its storage for a block header on the mainchain matching the passed height. The height should be lower than the tip of the blockchain, otherwise the method will return an empty array.</p>

<p>This method relies on a block index to avoid expensive lookups. Heights lower than IRIS activation wonâ€™t return blocks.
The gas cost is 5000.</p>

<h3 id="getbtcblockchainparentblockheaderbyhash">getBtcBlockchainParentBlockHeaderByHash</h3>

<h4 id="abi-signature-3">ABI signature</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function getBtcBlockchainParentBlockHeaderByHash(bytes32) returns (bytes)
</code></pre></div></div>

<h4 id="specification-4">Specification</h4>

<p>This methods expects a Sha256 value representing a bitcoin block hash. The Bridge will lookup the block the hash belongs to and later will get the parent of said block as the return value. For this method, if the parameterized block hash or the hash of its parent are not found, it will return an empty array.
The gas cost is 4900.</p>

<h3 id="copyright">Copyright</h3>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
