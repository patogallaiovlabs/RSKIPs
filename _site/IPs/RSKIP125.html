<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Create2 | RSK Improvement Proposals</title>
    <meta
      property="og:title"
      content="Create2 | RSK Improvement Proposals"
    />
    <meta name="description" content="RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards." />

  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="https://ips.rsk.co/IPs/RSKIP125" />
  <meta property="og:url" content="https://ips.rsk.co/IPs/RSKIP125" />
  <meta property="og:site_name" content="RSK Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "https://ips.rsk.co",
      "name": "RSK Improvement Proposals",
      "description": "RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" />
      <!-- Google Fonts -->
      <link href="https://fonts.googleapis.com/css?family=Quicksand:400,700,900&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,600,700,800&display=swap" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="RSK Improvement Proposals" /><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0=" crossorigin="anonymous"></script>
</head>
<body><header class="site-header" role="banner">
  <button id="dark-mode-toggle" class="dark-mode-toggle theme-toggle-button">
    <svg class="icon" style="width:24px;height:24px" viewBox="0 0 24 24">
      <path fill="currentColor" d="M7.5,2C5.71,3.15 4.5,5.18 4.5,7.5C4.5,9.82 5.71,11.85 7.53,13C4.46,13 2,10.54 2,7.5A5.5,5.5 0 0,1 7.5,2M19.07,3.5L20.5,4.93L4.93,20.5L3.5,19.07L19.07,3.5M12.89,5.93L11.41,5L9.97,6L10.39,4.3L9,3.24L10.75,3.12L11.33,1.47L12,3.1L13.73,3.13L12.38,4.26L12.89,5.93M9.59,9.54L8.43,8.81L7.31,9.59L7.65,8.27L6.56,7.44L7.92,7.35L8.37,6.06L8.88,7.33L10.24,7.36L9.19,8.23L9.59,9.54M19,13.5A5.5,5.5 0 0,1 13.5,19C12.28,19 11.15,18.6 10.24,17.93L17.93,10.24C18.6,11.15 19,12.28 19,13.5M14.6,20.08L17.37,18.93L17.13,22.28L14.6,20.08M18.93,17.38L20.08,14.61L22.28,17.15L18.93,17.38M20.08,12.42L18.94,9.64L22.28,9.88L20.08,12.42M9.63,18.93L12.4,20.08L9.87,22.27L9.63,18.93Z" />
    </svg>
  </button>


<div class="wrapper"><a class="site-title" rel="author" href="http://localhost:4000/">RSK Improvement Proposals</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link underline" href="http://localhost:4000/all">All</a><a class="page-link underline" href="http://localhost:4000/scalability">Scalability</a><a class="page-link underline" href="http://localhost:4000/security">Security</a><a class="page-link underline" href="http://localhost:4000/usability">Usability</a><a class="page-link underline" href="http://localhost:4000/fairness">Fairness</a><a class="page-link underline" href="http://localhost:4000/standardtrack">Standard Track</a></div>





      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Create2</h1>
  </header>

  <div class="post-content">
    <h1 id="create2">Create2</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">125</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">Create2</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">29-APR-19</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">SMS</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Sca, Usa</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">1</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Adopted</td>
    </tr>
  </tbody>
</table>

<h2 id="abstract">Abstract</h2>

<p>The purpose of this IP is to implement the CREATE2 opcode, as added to the Ethereum VM in the <a href="http://eips.ethereum.org/EIPS/eip-1014">EIP 1014</a></p>

<h2 id="motivation">Motivation</h2>

<p>Enables the creation of contracts with deterministic and repeatable addresses. This functionality is required for state channels interacting with a contract that only needs to be created on arbitration (also called counterfactual channels).</p>

<h2 id="specification">Specification</h2>

<p>Adds a new opcode at 0xf5, which takes 4 stack arguments: endowment, memory_start, memory_length, salt. Behaves identically to CREATE, except using <code class="language-plaintext highlighter-rouge">keccak256( 0xff ++ address ++ salt ++ keccak256(init_code))[12:]</code> instead of the usual sender-and-nonce-hash as the address where the contract is initialized at.</p>

<p>The <code class="language-plaintext highlighter-rouge">CREATE2</code> has the same <code class="language-plaintext highlighter-rouge">gas</code> schema as <code class="language-plaintext highlighter-rouge">CREATE</code>, but also an extra <code class="language-plaintext highlighter-rouge">hashcost</code> of <code class="language-plaintext highlighter-rouge">GSHA3WORD * ceil(len(init_code) / 32)</code>, to account for the hashing that must be performed. The <code class="language-plaintext highlighter-rouge">hashcost</code> is deducted at the same time as memory-expansion gas and <code class="language-plaintext highlighter-rouge">CreateGas</code> is deducted: <em>before</em> evaluation of the resulting address and the execution of <code class="language-plaintext highlighter-rouge">init_code</code>.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">0xff</code> is a single byte,</li>
  <li><code class="language-plaintext highlighter-rouge">address</code> is always <code class="language-plaintext highlighter-rouge">20</code> bytes,</li>
  <li><code class="language-plaintext highlighter-rouge">salt</code> is always <code class="language-plaintext highlighter-rouge">32</code> bytes (a stack item).</li>
</ul>

<p>The preimage for the final hashing round is thus always exactly <code class="language-plaintext highlighter-rouge">85</code> bytes long.</p>

<h2 id="rationale">Rationale</h2>

<h4 id="address-formula">Address formula</h4>

<ul>
  <li>Ensures that addresses created with this scheme cannot collide with addresses created using the traditional <code class="language-plaintext highlighter-rouge">keccak256(rlp([sender, nonce]))</code> formula, as <code class="language-plaintext highlighter-rouge">0xff</code> can only be a starting byte for RLP for data many petabytes long.</li>
  <li>Ensures that the hash preimage has a fixed size,</li>
</ul>

<h4 id="gas-cost">Gas cost</h4>

<p>Since address calculation depends on hashing the <code class="language-plaintext highlighter-rouge">init_code</code>, it would leave clients open to DoS attacks if executions could repeatedly cause hashing of large pieces of <code class="language-plaintext highlighter-rouge">init_code</code>, since expansion of memory is paid for only once. This EIP uses the same cost-per-word as the <code class="language-plaintext highlighter-rouge">SHA3</code> opcode.</p>

<h3 id="the-create-behavior-change">The <code class="language-plaintext highlighter-rouge">CREATE</code> behavior change</h3>

<p>The original <a href="http://eips.ethereum.org/EIPS/eip-1014">EIP</a> specified what to do in cases of a hash collision of the new address. Basically, in order to prevent this problem, each new contract created by these opcodes would start with its nonce in one, instead of zero. In addition, when there is a collision there is a check done if the existing contract has either non empty code, or non zero nonce, if one of this checks is true then the contract creation fails as if the init_code program would fail.</p>

<p>This RSKIP introduces a new behavior for the <code class="language-plaintext highlighter-rouge">CREATE</code> opcode, because every contract created will start with nonce 1, and fail in the rare case that a contract with the same address was previously created. The behavior is exactly the same than in the Ethereum VM, thus improving compatibility.</p>

<h3 id="examples">Examples</h3>

<p>Example 0</p>
<ul>
  <li>address <code class="language-plaintext highlighter-rouge">0x0000000000000000000000000000000000000000</code></li>
  <li>salt <code class="language-plaintext highlighter-rouge">0x0000000000000000000000000000000000000000000000000000000000000000</code></li>
  <li>init_code <code class="language-plaintext highlighter-rouge">0x00</code></li>
  <li>gas (assuming no mem expansion): <code class="language-plaintext highlighter-rouge">32006</code></li>
  <li>result: <code class="language-plaintext highlighter-rouge">0x4D1A2e2bB4F88F0250f26Ffff098B0b30B26BF38</code></li>
</ul>

<p>Example 1</p>
<ul>
  <li>address <code class="language-plaintext highlighter-rouge">0xdeadbeef00000000000000000000000000000000</code></li>
  <li>salt <code class="language-plaintext highlighter-rouge">0x0000000000000000000000000000000000000000000000000000000000000000</code></li>
  <li>init_code <code class="language-plaintext highlighter-rouge">0x00</code></li>
  <li>gas (assuming no mem expansion): <code class="language-plaintext highlighter-rouge">32006</code></li>
  <li>result: <code class="language-plaintext highlighter-rouge">0xB928f69Bb1D91Cd65274e3c79d8986362984fDA3</code></li>
</ul>

<p>Example 2</p>
<ul>
  <li>address <code class="language-plaintext highlighter-rouge">0xdeadbeef00000000000000000000000000000000</code></li>
  <li>salt <code class="language-plaintext highlighter-rouge">0x000000000000000000000000feed000000000000000000000000000000000000</code></li>
  <li>init_code <code class="language-plaintext highlighter-rouge">0x00</code></li>
  <li>gas (assuming no mem expansion): <code class="language-plaintext highlighter-rouge">32006</code></li>
  <li>result: <code class="language-plaintext highlighter-rouge">0xD04116cDd17beBE565EB2422F2497E06cC1C9833</code></li>
</ul>

<p>Example 3</p>
<ul>
  <li>address <code class="language-plaintext highlighter-rouge">0x0000000000000000000000000000000000000000</code></li>
  <li>salt <code class="language-plaintext highlighter-rouge">0x0000000000000000000000000000000000000000000000000000000000000000</code></li>
  <li>init_code <code class="language-plaintext highlighter-rouge">0xdeadbeef</code></li>
  <li>gas (assuming no mem expansion): <code class="language-plaintext highlighter-rouge">32006</code></li>
  <li>result: <code class="language-plaintext highlighter-rouge">0x70f2b2914A2a4b783FaEFb75f459A580616Fcb5e</code></li>
</ul>

<p>Example 4</p>
<ul>
  <li>address <code class="language-plaintext highlighter-rouge">0x00000000000000000000000000000000deadbeef</code></li>
  <li>salt <code class="language-plaintext highlighter-rouge">0x00000000000000000000000000000000000000000000000000000000cafebabe</code></li>
  <li>init_code <code class="language-plaintext highlighter-rouge">0xdeadbeef</code></li>
  <li>gas (assuming no mem expansion): <code class="language-plaintext highlighter-rouge">32006</code></li>
  <li>result: <code class="language-plaintext highlighter-rouge">0x60f3f640a8508fC6a86d45DF051962668E1e8AC7</code></li>
</ul>

<p>Example 5</p>
<ul>
  <li>address <code class="language-plaintext highlighter-rouge">0x00000000000000000000000000000000deadbeef</code></li>
  <li>salt <code class="language-plaintext highlighter-rouge">0x00000000000000000000000000000000000000000000000000000000cafebabe</code></li>
  <li>init_code <code class="language-plaintext highlighter-rouge">0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef</code></li>
  <li>gas (assuming no mem expansion): <code class="language-plaintext highlighter-rouge">32012</code></li>
  <li>result: <code class="language-plaintext highlighter-rouge">0x1d8bfDC5D46DC4f61D6b6115972536eBE6A8854C</code></li>
</ul>

<p>Example 6</p>
<ul>
  <li>address <code class="language-plaintext highlighter-rouge">0x0000000000000000000000000000000000000000</code></li>
  <li>salt <code class="language-plaintext highlighter-rouge">0x0000000000000000000000000000000000000000000000000000000000000000</code></li>
  <li>init_code <code class="language-plaintext highlighter-rouge">0x</code></li>
  <li>gas (assuming no mem expansion): <code class="language-plaintext highlighter-rouge">32000</code></li>
  <li>result: <code class="language-plaintext highlighter-rouge">0xE33C0C7F7df4809055C3ebA6c09CFe4BaF1BD9e0</code></li>
</ul>

<h3 id="copyright">Copyright</h3>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer>
    <div class="footer_cont">
        <div class="footer_box">
            <ul class="social-media-list"><li><a href="https://github.com/rsksmart/RSKIPs" target="_blank" rel="noopener"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">Visit on Github</span></a></li></ul>
        </div>
    </div>
</footer><script src="../assets/js/dark_mode.js"></script>
    <script src="../../assets/js/dark_mode.js"></script>
  </body>

</html>
