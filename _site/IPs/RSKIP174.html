<h1 id="preserve-balance-in-contract-creation">Preserve balance in contract creation</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">174</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">Preserve balance in contract creation</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">23-JUL-21</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">VK</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Usa/Fair</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">1</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Adopted</td>
    </tr>
  </tbody>
</table>

<h2 id="abstract">Abstract</h2>

<p>Contract addresses are deterministic. So it is possible to calculate an address of a contract before actual deployment
(by having an <code class="highlighter-rouge">Externally Owned Account</code> and its <code class="highlighter-rouge">Nonce</code>). Due to this property of contract addresses, it’s also possible
to send coins to an address of a future contract in advance and, as a result, make its balance positive without having
any deployed contract at that address yet.</p>

<p>A side effect of deploying a smart contract to the address with positive balance is that the balance is being burnt
and becomes zero.</p>

<p>Note: this side effect is only relevant in the case of contract creation via the JSON-RPC interface,
not via <code class="highlighter-rouge">CREATE</code> / <code class="highlighter-rouge">CREATE2</code> opcodes (these two opcodes do preserve balances).</p>

<h2 id="motivation">Motivation</h2>

<p>There’s no benefit of burning such funds after smart contracts creation. The funds are not being sent to any address,
nor are they being re-used in the network in some other way. They simply disappear.</p>

<p>This RSKIP proposes to preserve the balance after contracts creation.</p>

<p>This will also make the network compatible with the Ethereum ecosystem, where pre-funded addresses also preserve
their balances after deploying contracts at those addresses.</p>

<h2 id="implementation">Implementation</h2>

<p>The implementation should check if there’s any balance by a contract address before creation and add that amount (if any)
to the contract’s balance afterwards.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nc">Coin</span> <span class="n">oldBalance</span> <span class="o">=</span> <span class="n">getBalance</span><span class="o">(</span><span class="n">addr</span><span class="o">);</span>
    <span class="n">newAccount</span> <span class="o">=</span> <span class="n">createAccount</span><span class="o">(</span><span class="n">addr</span><span class="o">);</span>
    <span class="n">addBalance</span><span class="o">(</span><span class="n">addr</span><span class="o">,</span> <span class="n">oldBalance</span><span class="o">);</span>
</code></pre></div></div>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>This change is a hard-fork and therefore all full nodes must be updated.</p>

<h3 id="copyright">Copyright</h3>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
